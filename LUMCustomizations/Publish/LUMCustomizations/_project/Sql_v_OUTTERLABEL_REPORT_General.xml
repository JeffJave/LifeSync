<Sql TableName="v_OUTTERLABEL_REPORT_General" CustomScript="#CDATA">
    <CDATA name="CustomScript"><![CDATA[IF EXISTS
(
	SELECT *
	FROM SYS.views
	WHERE name = 'v_OUTTERLABEL_REPORT' AND SCHEMA_ID = SCHEMA_ID('dbo')
)
DROP VIEW [dbo].[v_OUTTERLABEL_REPORT]	
GO
CREATE VIEW v_OUTTERLABEL_REPORT AS
SELECT t.CompanyID,
	   t.ShipmentPlanID,
	   InventoryID,
	   Customer,
	   CustomerOrderNbr,
	   LotSerialNbr,
	   ProdLine,
	   PlannedShipDate,
	   PlannedShipQty,
	   NowNbr AS StartLabelNbr,
	   m.EndLabelNbr
FROM LumShipmentPlan t
INNER JOIN (
		select CompanyID, 
			   ShipmentPlanID, 
			   max(EndLabelNbr) as EndLabelNbr 
		from LumShipmentPlan 
		group by CompanyID, ShipmentPlanID) m on m.CompanyID = t.CompanyID
										     and m.ShipmentPlanID = t.ShipmentPlanID
CROSS JOIN(
	    SELECT DISTINCT NUMBER AS NowNbr
		FROM master.dbo.spt_values
		WHERE name IS NULL
) NumberPool
WHERE NowNbr BETWEEN t.StartLabelNbr AND t.EndLabelNbr]]></CDATA>
</Sql>